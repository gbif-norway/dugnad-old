$def with (key, record, forms, project, showfilters, nick)
<!doctype html>
<title>Dugnad</title>
<link rel='stylesheet' href='$config['base']/css/transcribe.css'>
<link rel='stylesheet' href='$config['base']/css/leaflet.css'>
<link rel='stylesheet' href='$config['base']/css/leaflet.draw.css'>

<script src='$config['base']/js/openseadragon.js'></script>
<script src='$config['base']/js/leaflet.js'></script>
<script src='$config['base']/js/leaflet.draw.js'></script>
<script src='$config['base']/js/wicket.js'></script>
<script src='$config['base']/js/wicket-leaflet.js'></script>
<script src='$config['base']/js/dugnad.js'></script>

<header>
  <nav>
    <a href='$prefix'>
      <h1><b>dugnad</b> annotering &amp; transkribering</h1>
    </a>
  
    $if helper.uid():
      $if project.get('filter') and showfilters:
        <form method=get>
          <p>
            <b>$_('filter-by-interest')</b>
            $for input in helper.showfilter(project).inputs:
              $:input.render()
            <input type=submit value="$_('filter')">
        </form>

    <a class='register-login' target=user href='/user/'>
      $if not helper.uid():
        $_('link-login')
      $else:
        $if helper.name():
          $_('signed-in-as')
          $helper.name()
        $else:
          $_('signed-in')
    </a>
  </nav>

  <nav class=actions>
    <p>
      $if helper.uid():
        <a href='/user/'>$_('greeting') $helper.name()</a>
        ·
        <a href='$prefix/$_('url-unfinished')'>$_('link-unfinished')</a>
        ·
      <a id='open-chat' target='chat' href='#'>$_('chat')</a>
      ·
      <a id='open-help' target='help' href='$prefix/project/telemark/$_('url-help')'>$_('help')</a>
  </nav>
</header>

<main>
  <aside id=map-overlay class=overlay>
    <div id="map"></div>
    <a id=ring></a>
  </aside>
  $if record:
    <section id="dz">
    <p class=modes>
      $if project.get('georeference'):
        $if record["_zoom"]:
          <a id=show-map data-replace="$_('link-image')" href='#'>$_('link-map')</a>
        $else:
          <a id=show-map>$_('no-image')</a>
    $if record["_zoom"]:
      <section id='dzi'></section>
      <script>
      var viewer = OpenSeadragon({
        id: "dzi",
        showRotationControl: true,
        minZoomImageRatio: 0.5,
        maxZoomImageRatio: 1.0,
        showFullPageControl: false,
        degrees: 0,
        showHomeControl: false,
        zoomPerScroll: 1.1,
        prefixUrl: "/static/images/",
        tileSources: "/static/tmp/$record["zoom"]"
      });
      </script>
    $else:
      <img class='nozoom' src='$record.get('associatedMedia')'>
    </section>
    <section id=tr>
      <form id='transcription' method='post' action="$prefix/$key">
        $if record.get('occurrenceID'):
          <h2 style='display:none;'>$record['occurrenceID']</h2>
        $else:
          <h2 style='display: none;'>$key</h2>
        $for name, form in forms.iteritems():
    			<fieldset>
    				<legend>$_(name)</legend>
    				$:form.render()
    			</fieldset>
        <p>
          <input name=save type=submit value="$_('submit')">
          $if showfilters:
            <input name=skip type=submit value="$_('skip')">
          $if helper.uid():
            <input name=later type=submit value="$_('finish-later')">
        <div id=help>
          <h3>$_('help')</h3>
          <p id=helptext>$_(project.get('help', {}).get('introduction'))
        </div>
      </form>
    </section>
  $else:
    <section id=error><p>$_('no-matching-records')</section>
</main>

<aside id=chat-overlay class=overlay>
  $if record and record.get('occurrenceID') and key:
    <iframe src='https://data.gbif.no/chat/chat.cgi/dugnad?name=$nick&url=https://data.gbif.no/dugnad/$key/$record.get('occurrenceID')'>
  $else:
    <iframe src='https://data.gbif.no/chat/chat.cgi/dugnad?name=$nick'>
</aside>

