$def with (key, record, forms, zoom, config, showfilters, nick)

<script src='/static/openseadragon.js'></script>
<script src='/static/leaflet.js'></script>
<script src='/static/leaflet.draw.js'></script>
<script src='/static/wicket.js'></script>
<script src='/static/wicket-leaflet.js'></script>
<script src='/static/dugnad.js'></script>

<header>
  <section id=title>
    <h1><a href='/dugnad'>dugnad</a></h1>
  </section>
  <section id=account>
  $if helper.uid():
    $if config.get('filter') and showfilters:
      <form method=get>
        <p>
          <b>$_('filter-by-interest')</b>
          $for input in helper.showfilter(config).inputs:
            $:input.render()
          <input type=submit value="$_('filter')">
      </form>
  $else:
    <p>$_('not-signed-in') <a target=user href='/user/'>$_('link-login')</a> $_("attribution")</small>
  </section>
  <section id=actions>
    <p>
      $if helper.uid():
        <a href='/dugnad/unfinished'>$_('link-unfinished')</a>
        ·
      <a id='open-chat' target='chat' href='#'>$_('chat')</a>
      ·
      <a id='open-help' target='help' href='/dugnad/project/telemark/help'>$_('help')</a>
  </section>
</header>

<main>
  <aside id=map-overlay class=overlay>
    <div id="map"></div>
    <a id=ring></a>
  </aside>
  $if record:
    <section id="dz">
    <p class=modes>
      $if config.get('georeference'):
        <a id=show-map data-replace="$_('link-image')" href='#'>$_('link-map')</a>
    $if zoom:
      <section id='dzi'></section>
      <script>
      var viewer = OpenSeadragon({
        id: "dzi",
        showRotationControl: true,
        minZoomImageRatio: 0.5,
        maxZoomImageRatio: 1.0,
        showFullPageControl: false,
        degrees: 0,
        showHomeControl: false,
        zoomPerScroll: 1.1,
        prefixUrl: "/static/images/",
        tileSources: "/static/tmp/$zoom"
      });
      </script>
    $else:
      <img class='nozoom' src='$record.get('associatedMedia')'>
    </section>
    <section id=tr>
      <form id='transcription' method='post' action="/dugnad/$key">
        $if record.get('occurrenceID'):
          <h2 style='display:none;'>$record['occurrenceID']</h2>
        $else:
          <h2 style='display: none;'>$key</h2>
        $for name, form in forms.iteritems():
    			<fieldset>
    				<legend>$_(name)</legend>
    				$:form.render()
    			</fieldset>
        <p>
          <input name=save type=submit value="$_('submit')">
          $if showfilters:
            <input name=skip type=submit value="$_('skip')">
          $if helper.uid():
            <input name=later type=submit value="$_('finish-later')">
        <div id=help>
          <h3>$_('help')</h3>
          <p id=helptext>$_(config.get('help', {}).get('introduction'))
        </div>
      </form>
    </section>
  $else:
    <section id=error><p>$_('no-matching-records')</section>
</main>

<aside id=chat-overlay class=overlay>
  $if record.get('occurrenceID') and key:
    <iframe src='https://data.gbif.no/chat/chat.cgi/dugnad?name=$nick&url=https://data.gbif.no/dugnad/$key/$record.get('occurrenceID')'>
  $else:
    <iframe src='https://data.gbif.no/chat/chat.cgi/dugnad?name=$nick'>
</aside>

