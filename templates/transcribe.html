$def with (key, record, forms, zoom, uid, config, showfilters, nick)

<script src='/static/openseadragon.js'></script>
<script src='/static/leaflet.js'></script>
<script src='/static/leaflet.draw.js'></script>
<script src='/static/wicket.js'></script>
<script src='/static/wicket-leaflet.js'></script>
<script src='/static/dugnad.js'></script>

<header>
  <section id=title>
    <h1>dugnad</h1>
  </section>
  <section id=account>
  $if uid:
    $if config.get('filter') and showfilters:
      <form method=get>
        <p>
          <b>Filter by area of interest:</b>
          $for input in helper.showfilter(config).inputs:
            $:input.render()
          <input type=submit value="$_('filter')">
      </form>
  $else:
    <p>Not signed in. <a href='/user/'>Log in or register</a> to have your annotations attributed to you.</small>
  </section>
  <section id=actions>
    <p>
      $if uid:
        <a href='/dugnad/unfinished'>Unfinished transcriptions</a>
        Â·
      <a id='open-chat' href='#'>Chat</a>
  </section>
</header>

<main>
  <aside id=map-overlay class=overlay>
    <div id="map"></div>
    <a id=ring></a>
  </aside>
  $if record:
    <section id="dz">
    <p class=modes>
      <a id=show-map href='#'>Show map</a>
    $if zoom:
      <section id='dzi'></section>
      <script>
      var viewer = OpenSeadragon({
        id: "dzi",
        showRotationControl: true,
        minZoomImageRatio: 0.5,
        maxZoomImageRatio: 1.0,
        showFullPageControl: false,
        degrees: 0,
        showHomeControl: false,
        zoomPerScroll: 1.1,
        prefixUrl: "/static/images/",
        tileSources: "/static/tmp/$zoom"
      });
      </script>
    $else:
      <img class='nozoom' src='$record.get('associatedMedia')'>
    </section>
    <section id=tr>
      <form id='transcription' method='post' action="/dugnad/$key">
        $if record.get('occurrenceID'):
          <h2>$record['occurrenceID']</h2>
        $else:
          <h2>$key</h2>
        $for name, form in forms.iteritems():
    			<fieldset>
    				<legend>$_(name)</legend>
    				$:form.render()
    			</fieldset>
        <p>
          <input name=save type=submit value="$_('submit')">
          $if showfilters:
            <input name=skip type=submit value="$_('skip')">
          $if uid:
            <input name=later type=submit value="$_('finish-later')">
      </form>
    </section>
  $else:
    <section id=error><p>No records matching your area of interest!</section>
</main>

<aside id=chat-overlay class=overlay>
  <iframe src='https://data.gbif.no/chat/chat.cgi/dugnad?name=$nick'>
</aside>

